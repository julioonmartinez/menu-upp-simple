---
// src/pages/dashboard/restaurants.astro
// Página de Astro 5 para gestionar restaurantes con Svelte 5

import Layout from '../../layouts/Layout.astro';
import MenuuppLayout from '../../layouts/MenuuppLayout.astro';
import RestaurantDashboard from '../../components/RestaurantDashboard.svelte';
import CreateRestaurant from '../../components/CreateRestaurant.svelte';
import { restaurantStore } from '../../stores/restaurantStore.ts';
// import { getSession } from '../../utils/auth';

// Verificar autenticación en el servidor
// const session = await getSession(Astro.request);

// if (!session) {
//   return Astro.redirect('/login');
// }

// // Verificar que el usuario pueda crear restaurantes
// if (!['owner', 'admin'].includes(session.user.role)) {
//   return Astro.redirect('/dashboard?error=insufficient_permissions');
// }

// Datos del usuario desde el servidor
const userData = {
  id: '{session.user.id}',
  role: '{session.user.role}',
  name: '{session.user.name}',
  email: '{session.user.email}'
};

// Metadatos de la página
const pageTitle = 'Mis Restaurantes - Dashboard';
const pageDescription = 'Gestiona tus restaurantes, crea nuevos y edita la información existente.';
---

<MenuuppLayout title={pageTitle} description={pageDescription}>
  <main class="dashboard-main bg-gray min-h-screen">
    <!-- Header de la página -->
    <section class="page-header bg-white border-b border-accent py-4 md:py-8">
      <div class="container">
        <div class="header-content text-center">
          <div class="breadcrumb flex items-center justify-center gap-xs mb-sm text-sm text-muted">
            <a href="/dashboard" class="text-accent hover:text-primary transition-fast">Dashboard</a>
            <span class="separator text-accent">/</span>
            <span class="current font-semibold text-primary">Restaurantes</span>
          </div>
          <h1 class="page-title text-4xl font-bold text-primary mb-xs leading-tight">Gestión de Restaurantes</h1>
          <p class="page-description text-lg text-muted max-w-xl mx-auto leading-relaxed">
            Crea y administra tus restaurantes digitales. Desde aquí puedes configurar 
            la información básica, subir imágenes y gestionar todos los aspectos de tu negocio.
          </p>
        </div>
      </div>
    </section>

    <!-- Contenido principal -->
    <section class="dashboard-content py-3xl">
      <div class="container">
        <!-- Dashboard de restaurantes (Componente Svelte 5) -->
        <RestaurantDashboard 
          currentUser={userData}
          client:load 
        />
        <!-- Información adicional y guías -->
        <div class="help-section mt-xl">
          <div class="help-grid grid gap-lg grid-cols-1 md:grid-cols-3">
            <div class="help-card card text-center grid gap-sm">
              <div class="help-icon flex items-center justify-center mx-auto mb-md bg-gradient-primary rounded-full w-10 h-10 text-inverse">
                <i class="fa-solid fa-seedling fa-lg"></i>
              </div>
              <h3 class="text-lg font-semibold text-primary mb-xs">Primeros Pasos</h3>
              <p class="text-muted leading-normal mb-md">
                Crea tu primer restaurante con información básica. 
                Luego podrás agregar menús, imágenes y personalizar el diseño.
              </p>
              <a href="/docs/getting-started" class="help-link text-accent font-semibold text-sm hover:text-primary transition-fast">
                Ver guía completa
              </a>
            </div>
            <div class="help-card card text-center grid gap-sm">
              <div class="help-icon flex items-center justify-center mx-auto mb-md bg-gradient-primary rounded-full w-10 h-10 text-inverse">
                <i class="fa-solid fa-image fa-lg"></i>
              </div>
              <h3 class="text-lg font-semibold text-primary mb-xs">Optimizar Imágenes</h3>
              <p class="text-muted leading-normal mb-md">
                Usa imágenes de alta calidad para logo, portada y platillos. 
                Recomendamos formato webp y tamaños optimizados.
              </p>
              <a href="/docs/images" class="help-link text-accent font-semibold text-sm hover:text-primary transition-fast">
                Guía de imágenes
              </a>
            </div>
            <div class="help-card card text-center grid gap-sm">
              <div class="help-icon flex items-center justify-center mx-auto mb-md bg-gradient-primary rounded-full text-inverse">
                <i class="fa-solid fa-qrcode fa-lg"></i>
              </div>
              <h3 class="text-lg font-semibold text-primary mb-xs">Código QR</h3>
              <p class="text-muted leading-normal mb-md">
                Genera códigos QR personalizados para que tus clientes 
                accedan fácilmente a tu menú digital.
              </p>
              <a href="/docs/qr-codes" class="help-link text-accent font-semibold text-sm hover:text-primary transition-fast">
                Generar QR
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</MenuuppLayout>

<style>
  /* Solo estilos locales estrictamente necesarios */
  .dashboard-main {
    /* El fondo y min-height ahora usan utilidades globales */
  }
  .help-icon {
    justify-self: center;
    box-shadow: var(--shadow-sm);
    width: 48px;
    height: 48px;
    font-size: 1.2rem; /* Ajuste para iconos FontAwesome */
  
  }
  @media (max-width: 768px) {
    .page-title { font-size: var(--font-2xl); }
    .dashboard-content { padding: var(--spacing-xl) 0; }
    .help-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 480px) {
    .breadcrumb { flex-direction: column; gap: var(--spacing-xs); }
    .page-title { font-size: var(--font-xl); }
  }
</style>