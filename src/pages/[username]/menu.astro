---
// src/pages/[username]/menu.astro
// Vista del menú optimizada con mejores prácticas de SEO, Performance, Accessibility y UX
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import CategoryNav from '../../components/CategoryNav.astro';
import DynamicMenu from '../../components/DynamicMenu.svelte';
import HeroCarousel from '../../components/HeroCarousel.astro';
import FloatingButton from '../../components/microcomponentes/FloatingButton.svelte';
import BottomSheetQR from '../../components/BottomSheetQR.astro';
import { fetchAllRestaurantDataByUsername, fetchLinksByUsername } from '../../services/apiService';
import type { Restaurant } from '../../interfaces/restaurant';
import type { Category } from '../../interfaces/categories';
import type { Dish } from '../../interfaces/dish';
import type { LinkTree } from '../../interfaces';

// Obtener el username de los parámetros de la URL
const { username } = Astro.params;

if (!username) {
  return Astro.redirect('/404');
}

// Estados iniciales
let restaurantInfo: Restaurant | null = null;
let categoriesInfo: Category[] | null = null;
let dishesInfo: Dish[] | null = null;
let errorMessage: string | null = null;
let linksTreeInfo: LinkTree | null = null;

try {
  // Obtener todos los datos del restaurante usando el username
  const [restaurantData, linksData] = await Promise.all([
    fetchAllRestaurantDataByUsername(username),
    fetchLinksByUsername(username)
  ]);
  
  restaurantInfo = restaurantData.restaurant;
  categoriesInfo = restaurantData.categories;
  dishesInfo = restaurantData.dishes;
  linksTreeInfo = linksData;

  // Verificar que el restaurante existe y está activo
  if (!restaurantInfo || !restaurantInfo.active) {
    return Astro.redirect('/404');
  }

} catch (error) {
  errorMessage = error instanceof Error ? error.message : 'Restaurant not found';
  
  // Si no se encuentra el restaurante, redirigir a 404
  if (error instanceof Error && error.message.includes('404')) {
    return Astro.redirect('/404');
  }
}

// Configurar slides del hero con lazy loading
const slides = restaurantInfo?.heroSlides || [
  {
    imageUrl: restaurantInfo?.coverImage || '/images/restaurants/default/cover.webp',
    title: `Bienvenidos a ${restaurantInfo?.name || 'nuestro restaurante'}`,
    subtitle: restaurantInfo?.description || 'Disfruta de la mejor comida tradicional',
    alt: `Imagen principal de ${restaurantInfo?.name || 'nuestro restaurante'}`
  }
];

// Meta tags optimizados para SEO
const pageTitle = restaurantInfo 
  ? `${restaurantInfo.name} - Menú`
  : 'Menú Digital';

const pageDescription = restaurantInfo 
  ? `Descubre el delicioso menú de ${restaurantInfo.name}. ${categoriesInfo?.length || 0} categorías con ${dishesInfo?.length || 0} platillos únicos. ${restaurantInfo.cuisineType?.join(', ') || 'Cocina tradicional'}.`
  : 'Menú digital del restaurante';

const canonicalURL = new URL(`/${username}/menu`, Astro.site);
const ogImage = restaurantInfo?.coverImage || restaurantInfo?.profileImage || '/default-menu-og.jpg';

// Verificar que tenemos los datos necesarios
const hasValidData = restaurantInfo && categoriesInfo && categoriesInfo.length > 0;

// Colores del tema
const primaryColor = restaurantInfo?.primaryColor || '#FF4500';
const secondaryColor = restaurantInfo?.secondaryColor || '#FF6B35';
const backgroundColor = restaurantInfo?.backgroundColor || linksTreeInfo?.backgroundColor || '#FFFFFF';

// Función para determinar si un color es claro u oscuro
function isLightColor(color: string): boolean {
  const hex = color.replace('#', '');
  const r = parseInt(hex.substr(0, 2), 16);
  const g = parseInt(hex.substr(2, 2), 16);
  const b = parseInt(hex.substr(4, 2), 16);
  const brightness = ((r * 299) + (g * 587) + (b * 114)) / 1000;
  return brightness > 155;
}
// Utilidad para iniciales (si no existe ya)
function getInitials(name: string): string {
  if (!name) return '';
  return name
    .split(' ')
    .map((word: string) => word[0])
    .join('')
    .toUpperCase();
}

// Schema markup específico para menú
const menuStructuredData = hasValidData ? {
  "@context": "https://schema.org",
  "@type": "Menu",
  "name": `Menú de ${restaurantInfo?.name}`,
  "description": pageDescription,
  "hasMenuSection": categoriesInfo?.map(category => ({
    "@type": "MenuSection",
    "name": category.name,
    "description": category.description,
    "hasMenuItem": dishesInfo?.filter(dish => dish.categoryId === category.id).map(dish => ({
      "@type": "MenuItem",
      "name": dish.name,
      "description": dish.description,
      "image": dish.image,
      "offers": {
        "@type": "Offer",
        "price": dish.price,
        "priceCurrency": "MXN"
      },
      "nutrition": dish.nutritionalInfo && {
        "@type": "NutritionInformation",
        "calories": dish.nutritionalInfo.calories
      }
    }))
  }))
} : null;

---

<Layout 
  restaurant={restaurantInfo!} 
  backgroundColor={backgroundColor}
  title={pageTitle}
  description={pageDescription}
  image={ogImage}
  canonicalURL={canonicalURL}
>
  <!-- Schema markup para el menú -->
  {menuStructuredData && (
    <script type="application/ld+json" set:html={JSON.stringify(menuStructuredData)} />
  )}

  <!-- Header del restaurante con mejoras de accesibilidad -->
  {hasValidData && (
    <Header 
      restaurant={restaurantInfo!} 
      linkTree={linksTreeInfo!}
      aria-label={`Información del restaurante ${restaurantInfo!.name}`}
    />
  )}
  
  <!-- Bottom Sheet QR con lazy loading -->
  {hasValidData && (
    <BottomSheetQR 
      restaurant={restaurantInfo!}
      linkTree={linksTreeInfo!}
    />
  )}
  
  <!-- Navegación de categorías con sticky behavior mejorado -->
  {hasValidData && (
    <nav 
      class="category-nav-wrapper" 
      role="navigation"
      aria-label="Navegación de categorías del menú"
    >
      <CategoryNav 
        categories={categoriesInfo!} 
        restaurant={restaurantInfo!} 
        linkTree={linksTreeInfo!} 
      />
    </nav>
  )}
  
  <!-- Hero Carousel moderno de cards -->
  {hasValidData && (
    <section 
      class="hero-section"
      aria-label="Promociones y destacados del restaurante"
    >
      <HeroCarousel 
        slides={slides}
        primaryColor={primaryColor}
        secondaryColor={secondaryColor}
        backgroundColor={backgroundColor}
      />
    </section>
  )}
  
  <!-- Contenedor del menú optimizado -->
  {hasValidData ? (
    <section 
      class="menu-container" 
      id="menu-main-container"
      aria-label="Menú del restaurante"
    >
     
      <div 
        class="menu-skeleton" 
        id="menu-skeleton"
        aria-label="Cargando menú"
        role="status"
        aria-live="polite"
      >
        <div class="skeleton-header">
          <div class="skeleton-title" aria-hidden="true"></div>
          <div class="skeleton-subtitle" aria-hidden="true"></div>
        </div>
        <div class="skeleton-grid" aria-hidden="true">
          {Array.from({length: 6}).map((_, i) => (
            <article class="skeleton-card">
              <div class="skeleton-image"></div>
              <div class="skeleton-content">
                <div class="skeleton-line skeleton-line-title"></div>
                <div class="skeleton-line skeleton-line-subtitle"></div>
                <div class="skeleton-line skeleton-line-price"></div>
              </div>
            </article>
          ))}
        </div>
        <span class="sr-only">Cargando menú del restaurante...</span>
      </div>
      
      <!-- Componente Svelte optimizado -->
      <div 
        class="dynamic-menu-wrapper" 
        id="dynamic-menu-wrapper" 
        style="display: none;"
        role="main"
      >
        <DynamicMenu 
          username={username}
          categories={categoriesInfo!}
          restaurant={restaurantInfo!}
          storeMode={false}
          client:load
          primaryColor={primaryColor}
          secondaryColor={secondaryColor}
          backgroundColor={backgroundColor}
        />
      </div>
    </section>
  ) : (
    <section 
      class="error-container"
      role="alert"
      aria-live="assertive"
    >
      <div class="error-content">
        <div class="error-icon" aria-hidden="true">⚠️</div>
        <h1 class="error-title">Error al cargar el menú</h1>
        <p class="error-description">
          {errorMessage || 'No se pudieron cargar los datos del restaurante'}
        </p>
        <a 
          href={`/${username}`} 
          class="back-button"
          aria-label={`Volver al perfil de ${username}`}
        >
          Volver al perfil
        </a>
      </div>
    </section>
  )}
  
  <!-- Footer del menú optimizado -->
  <footer 
    class="menu-footer"
    id="menu-footer"
    style={`
      --primary-color: ${primaryColor};
      --text-color: ${restaurantInfo?.textColor || linksTreeInfo?.textColor || (isLightColor(primaryColor) ? '#222' : '#fff')};
      opacity: 0;
      transition: opacity 0.3s ease;
    `}
    role="contentinfo"
  >
    <div class="footer-content">
      <div class="footer-main">
        <div class="footer-logo">
          {restaurantInfo?.logo_data?.url
            ? <img src={restaurantInfo.logo_data.url} alt={restaurantInfo.name} />
            : <span class="footer-initials">{getInitials(restaurantInfo?.name || '')}</span>
          }
          <div>
            <h3>{restaurantInfo!.name}</h3>
            {restaurantInfo!.address && (
              <address class="address">{restaurantInfo!.address}</address>
            )}
            {restaurantInfo!.phone && (
              <a href={`tel:${restaurantInfo!.phone}`} class="footer-phone">{restaurantInfo!.phone}</a>
            )}
          </div>
        </div>
        {restaurantInfo!.socialLinks && (
          <div class="footer-social">
            {Object.entries(restaurantInfo!.socialLinks).map(([platform, url]) =>
              url && (
                <a
                  href={url}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label={`Síguenos en ${platform}`}
                  class={`footer-social-link footer-social-link-${platform}`}
                >
                  <i class={`fab fa-${platform}`}></i>
                </a>
              )
            )}
          </div>
        )}
      </div>
      <div class="footer-bottom">
        <span>© {new Date().getFullYear()} {restaurantInfo!.name}</span>
        <span class="footer-powered">Powered by <a href="https://menuupp.com" target="_blank" rel="noopener">Menu-upp</a></span>
      </div>
    </div>
  </footer>
  
  <!-- Floating Button optimizado -->
  <FloatingButton 
    username={restaurantInfo?.username} 
    client:load 
    colorPrimary={primaryColor}
    aria-label="Botón de acción flotante"
  />
   
</Layout>

<style>
  /* Variables CSS optimizadas */
  :root {
    --border-radius-sm: 8px;
    --border-radius-md: 16px;
    --border-radius-lg: 24px;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.15);
    --transition-fast: 0.2s ease;
    --transition-normal: 0.3s ease;
    --transition-slow: 0.5s ease;
    --z-index-sticky: 100;
    --z-index-floating: 200;
    --z-index-modal: 1000;
  }

  /* Contenedor principal del menú optimizado */
  .menu-container {
    min-height: 100vh;
    position: relative;
    contain: layout style paint;
  }

  /* Category nav wrapper con mejor sticky behavior */
  .category-nav-wrapper {
    position: sticky;
    top: 0;
    z-index: var(--z-index-sticky);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: all var(--transition-normal);
  }

  /* Hero section optimizada */
  .hero-section {
    position: relative;
    overflow: hidden;
  }

  /* Skeleton loader mejorado con mejor performance */
  .menu-skeleton {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
    animation: fadeIn var(--transition-normal);
    will-change: opacity;
  }

  .skeleton-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .skeleton-title,
  .skeleton-subtitle {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: var(--border-radius-sm);
    margin: 0 auto;
  }

  .skeleton-title {
    height: 2rem;
    width: min(300px, 80%);
    margin-bottom: 1rem;
  }

  .skeleton-subtitle {
    height: 1rem;
    width: min(200px, 60%);
    animation-delay: 0.2s;
  }

  .skeleton-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(min(320px, 100%), 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .skeleton-card {
    background: white;
    border-radius: var(--border-radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    animation: slideInUp 0.6s ease forwards;
    will-change: transform, opacity;
  }

  .skeleton-card:nth-child(n) {
    animation-delay: calc(0.1s * var(--nth-child, 1));
  }

  .skeleton-image {
    height: 200px;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }

  .skeleton-content {
    padding: 1.5rem;
  }

  .skeleton-line {
    height: 1rem;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: var(--border-radius-sm);
    margin-bottom: 0.75rem;
  }

  .skeleton-line-title {
    width: 80%;
    height: 1.25rem;
  }

  .skeleton-line-subtitle {
    width: 100%;
    animation-delay: 0.2s;
  }

  .skeleton-line-price {
    width: 40%;
    animation-delay: 0.4s;
  }

  /* Wrapper del componente dinámico */
  .dynamic-menu-wrapper {
    width: 100%;
    contain: layout style paint;
  }

  /* Error container mejorado */
  .error-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 70vh;
    padding: 2rem;
  }
  
  .error-content {
    text-align: center;
    max-width: 500px;
    background: white;
    padding: 3rem 2rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    animation: slideInUp 0.6s ease;
  }
  
  .error-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    animation: bounce 2s infinite;
  }
  
  .error-title {
    font-size: clamp(1.5rem, 4vw, 1.75rem);
    font-weight: 700;
    color: #dc2626;
    margin-bottom: 1rem;
  }
  
  .error-description {
    color: #6b7280;
    margin-bottom: 2rem;
    line-height: 1.6;
  }
  
  .back-button {
    display: inline-block;
    padding: 12px 24px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    box-shadow: var(--shadow-md);
  }
  
  .back-button:hover,
  .back-button:focus {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .back-button:active {
    transform: translateY(0);
  }
  
  /* Footer optimizado */
  .menu-footer {
    background: var(--primary-color);
    margin-top: 3rem;
    color: var(--text-color);
  }
  
  .footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 2rem;
    align-items: start;
  }
  .footer-logo img {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  justify-self: center;
}
  
  .restaurant-info h3 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  
  .restaurant-info p,
  .restaurant-info address {
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
    font-style: normal;
  }

  .restaurant-info a {
    color: inherit;
    text-decoration: none;
    transition: opacity var(--transition-fast);
  }

  .restaurant-info a:hover {
    opacity: 0.8;
  }

  /* Social links */
  .social-links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .social-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    color: var(--text-color);
    border-radius: 50%;
    text-decoration: none;
    transition: all var(--transition-fast);
  }

  .social-link:hover,
  .social-link:focus {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
  }
  
  .footer-bottom {
    background: rgba(0, 0, 0, 0.1);
    padding: 1rem;
    text-align: center;
  }
  
  .footer-bottom p {
    font-size: 0.75rem;
    margin: 0;
    opacity: 0.8;
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Animaciones optimizadas */
  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
      transform: translateY(0);
    }
    40%, 43% {
      transform: translateY(-10px);
    }
    70% {
      transform: translateY(-5px);
    }
    90% {
      transform: translateY(-3px);
    }
  }

  /* Responsive design optimizado */
  @media (max-width: 768px) {
    .skeleton-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .footer-content {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      text-align: center;
    }

    .social-links {
      justify-content: center;
    }
  }
  
  @media (max-width: 480px) {
    .menu-skeleton {
      padding: 1rem;
    }
    
    .skeleton-grid {
      gap: 1rem;
    }
    
    .error-content {
      padding: 2rem 1rem;
    }
    
    .footer-content {
      padding: 1.5rem 1rem;
    }
  }

  /* Performance optimizations */
  @media (prefers-reduced-motion: reduce) {
    .skeleton-title,
    .skeleton-subtitle,
    .skeleton-image,
    .skeleton-line {
      animation: none;
    }
    
    .skeleton-card {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .skeleton-title,
    .skeleton-subtitle,
    .skeleton-image,
    .skeleton-line {
      background: #ccc;
    }
  }

  /* Print styles */
  @media print {
    .menu-skeleton,
    .category-nav-wrapper,
    .hero-section {
      display: none;
    }
    
    .dynamic-menu-wrapper {
      display: block !important;
      opacity: 1 !important;
    }
  }
</style>

<script>
  // Performance optimizations y analytics mejorados
  document.addEventListener('DOMContentLoaded', () => {
    // Track page view con más datos
    const trackingData = {
      restaurantUsername: window.location.pathname.split('/')[1],
      timestamp: Date.now(),
      userAgent: navigator.userAgent,
      referrer: document.referrer,
      viewport: {
        width: window.innerWidth,
        height: window.innerHeight
      },
      connection: (navigator as any).connection ? {
        effectiveType: (navigator as any).connection.effectiveType,
        downlink: (navigator as any).connection.downlink,
        saveData: (navigator as any).connection.saveData
      } : null
    };

    window.dispatchEvent(new CustomEvent('menuPageView', { detail: trackingData }));
    
    // Manejar la transición del skeleton al contenido real con mejor performance
    let svelteComponentReady = false;
    let transitionTriggered = false;
    
    function handleMenuTransition() {
      if (transitionTriggered) return;
      transitionTriggered = true;
      
      const skeleton = document.getElementById('menu-skeleton');
      const dynamicWrapper = document.getElementById('dynamic-menu-wrapper');
      const footer = document.getElementById('menu-footer');
      
      if (skeleton && dynamicWrapper) {
        // Use requestAnimationFrame for smooth transitions
        requestAnimationFrame(() => {
          skeleton.style.transition = 'opacity 0.3s ease';
          skeleton.style.opacity = '0';
          
          setTimeout(() => {
            skeleton.style.display = 'none';
            dynamicWrapper.style.display = 'block';
            dynamicWrapper.style.opacity = '0';
            dynamicWrapper.style.transition = 'opacity 0.3s ease';
            
            requestAnimationFrame(() => {
              dynamicWrapper.style.opacity = '1';
              
              if (footer) {
                footer.style.opacity = '1';
              }
            });
          }, 300);
        });
      }
    }
    
    // Escuchar eventos del componente Svelte
    document.addEventListener('svelteMenuReady', handleMenuTransition);
    
    // Intersection Observer para lazy loading mejorado
    const observerOptions = {
      rootMargin: '50px',
      threshold: 0.1
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Trigger transition when menu comes into view
          handleMenuTransition();
        }
      });
    }, observerOptions);
    
    const menuContainer = document.getElementById('menu-main-container');
    if (menuContainer) {
      observer.observe(menuContainer);
    }
    
    // Fallback timer con tiempos optimizados
    const fallbackTimer = setTimeout(() => {
      if (!svelteComponentReady) {
        handleMenuTransition();
      }
    }, 5000); // Reducido de 10s a 5s
    
    // Verificación periódica optimizada
    const checkInterval = setInterval(() => {
      const dynamicMenuContent = document.querySelector('#menu-section');
      const hasMenuContent = dynamicMenuContent && dynamicMenuContent.children.length > 0;
      const hasDishes = dynamicMenuContent && dynamicMenuContent.querySelector('.dishes-grid, .empty-state, .error-state');
      
      if (hasMenuContent || hasDishes) {
        svelteComponentReady = true;
        handleMenuTransition();
        clearInterval(checkInterval);
        clearTimeout(fallbackTimer);
      }
    }, 100); // Verificar cada 100ms
    
    // Cleanup interval después de 5 segundos
    setTimeout(() => {
      clearInterval(checkInterval);
    }, 5000);
    
    // Manejo especial para restaurantes sin platillos
    const hasCategories = document.querySelector('.category-nav-wrapper') !== null;
    const hasDishes = document.querySelector('#menu-section') !== null;
    
    if (!hasCategories || !hasDishes) {
      // Trigger transition immediately for empty restaurants
      setTimeout(() => {
        handleMenuTransition();
      }, 1000);
    } else {
      // Si hay categorías y platillos, esperar a que el componente Svelte esté listo
    }
    
  });

      // Sticky navigation mejorado con Intersection Observer
    document.addEventListener('DOMContentLoaded', () => {
      const categoryNav = document.querySelector('.category-nav-wrapper');
      if (!categoryNav) {
        return;
      }
      
      const heroSection = document.querySelector('.hero-section');
      if (!heroSection) {
        return;
      }
      
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              categoryNav.classList.remove('is-sticky');
            } else {
              categoryNav.classList.add('is-sticky');
            }
          });
        },
        { 
          rootMargin: '-1px 0px 0px 0px',
          threshold: 0 
        }
      );
      
      observer.observe(heroSection);
    });

  // Error tracking mejorado
  window.addEventListener('error', (event) => {
    // console.error('Menu page error:', {
    //   message: event.message,
    //   filename: event.filename,
    //   lineno: event.lineno,
    //   colno: event.colno,
    //   error: event.error
    // });
  });

  // Performance monitoring
  if ('PerformanceObserver' in window) {
    const observer = new PerformanceObserver((list) => {
      list.getEntries().forEach((entry) => {
        if (entry.entryType === 'measure') {
          // console.log(`Performance: ${entry.name}: ${entry.duration}ms`);
        }
      });
    });
    
    observer.observe({ entryTypes: ['measure'] });
    
    // Measure critical timings
    window.addEventListener('load', () => {
      performance.mark('menu-page-loaded');
      performance.measure('menu-page-load-time', 'navigationStart', 'menu-page-loaded');
    });
  }
</script>