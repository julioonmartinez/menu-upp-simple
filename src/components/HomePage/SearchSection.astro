---
// src/components/HomePage/SearchSection.astro
interface SearchFilter {
  id: string;
  label: string;
  active?: boolean;
}

interface Props {
  title?: string;
  description?: string;
  placeholder?: string;
  filters?: SearchFilter[];
}

const {
  title = "Encuentra tu Próxima Experiencia",
  description = "Explora nuestra colección curada de restaurantes excepcionales",
  placeholder = "Buscar restaurante, tipo de comida...",
  filters = [
    { id: 'all', label: 'Todos', active: true },
    { id: 'italiana', label: 'Italiana' },
    { id: 'mexicana', label: 'Mexicana' },
    { id: 'japonesa', label: 'Japonesa' },
    { id: 'premium', label: 'Premium' }
  ]
} = Astro.props;
---

<section class="search-section" id="explorar">
  <div class="container">
    <div class="search-content animate-on-scroll">
      <div class="search-header">
        <h2 class="search-title">{title.split(' ').map((word, i) => 
          word.toLowerCase().includes('experiencia') || word.toLowerCase().includes('próxima') ? 
          <span class="text-orange">{word}</span> : 
          word + ' '
        )}</h2>
        <p class="search-description">
          {description}
        </p>
      </div>
      
      <div class="search-box">
        <div class="search-input-container">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            placeholder={placeholder}
            class="search-input" 
            id="search-input"
            autocomplete="off"
            spellcheck="false"
          />
          <button class="search-btn" type="button">
            <span>Buscar</span>
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        
        <div class="search-filters">
          {filters.map(filter => (
            <button 
              class={`filter-btn ${filter.active ? 'active' : ''}`}
              data-filter={filter.id}
              type="button"
            >
              {filter.label}
            </button>
          ))}
        </div>
        
        <div class="search-suggestions" id="search-suggestions">
          <!-- Suggestions will be populated dynamically -->
        </div>
      </div>
      
      <div class="search-stats">
        <div class="stat">
          <span class="stat-number">50+</span>
          <span class="stat-label">Restaurantes</span>
        </div>
        <div class="stat">
          <span class="stat-number">15+</span>
          <span class="stat-label">Tipos de Cocina</span>
        </div>
        <div class="stat">
          <span class="stat-number">2.5K+</span>
          <span class="stat-label">Platillos Únicos</span>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .search-section {
    padding: var(--space-4xl) 0;
    background: var(--gradient-dark);
    position: relative;
    overflow: hidden;
  }
  
  .search-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 70% 30%, rgba(255, 107, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, rgba(255, 159, 80, 0.05) 0%, transparent 50%);
    pointer-events: none;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
    position: relative;
    z-index: 2;
  }
  
  .search-content {
    text-align: center;
    color: var(--pure-white);
  }
  
  .search-header {
    margin-bottom: var(--space-3xl);
  }
  
  .search-title {
    font-family: var(--font-primary);
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    margin-bottom: var(--space-lg);
    color: var(--pure-white);
    line-height: 1.2;
  }
  
  .text-orange {
    color: var(--primary-orange);
  }
  
  .search-description {
    font-size: 1.2rem;
    color: var(--neutral-light);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  .search-box {
    max-width: 800px;
    margin: 0 auto;
    position: relative;
  }
  
  .search-input-container {
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-radius: var(--radius-full);
    padding: var(--space-md);
    margin-bottom: var(--space-xl);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all var(--transition-normal);
    position: relative;
  }
  
  .search-input-container:focus-within {
    border-color: var(--primary-orange);
    box-shadow: 0 0 0 4px rgba(255, 107, 0, 0.1);
  }
  
  .search-icon {
    color: var(--neutral-light);
    margin: 0 var(--space-lg);
    font-size: 1.1rem;
  }
  
  .search-input {
    flex: 1;
    background: none;
    border: none;
    color: var(--pure-white);
    font-size: 1.1rem;
    outline: none;
    padding: var(--space-sm) 0;
  }
  
  .search-input::placeholder {
    color: var(--neutral-light);
    opacity: 0.8;
  }
  
  .search-btn {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-xl);
    background: var(--gradient-primary);
    color: var(--pure-white);
    border: none;
    border-radius: var(--radius-full);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-normal);
    font-size: 1rem;
  }
  
  .search-btn:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-glow);
  }
  
  .search-btn:active {
    transform: scale(0.98);
  }
  
  .search-filters {
    display: flex;
    justify-content: center;
    gap: var(--space-md);
    flex-wrap: wrap;
    margin-bottom: var(--space-2xl);
  }
  
  .filter-btn {
    padding: var(--space-md) var(--space-lg);
    background: rgba(255, 255, 255, 0.1);
    color: var(--neutral-light);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: all var(--transition-normal);
    backdrop-filter: blur(10px);
    font-weight: 500;
    font-size: 0.9rem;
  }
  
  .filter-btn:hover,
  .filter-btn.active {
    background: var(--gradient-primary);
    color: var(--pure-white);
    border-color: var(--primary-orange);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }
  
  .search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: var(--radius-lg);
    margin-top: var(--space-sm);
    max-height: 300px;
    overflow-y: auto;
    z-index: 10;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-normal);
    box-shadow: var(--shadow-lg);
  }
  
  .search-suggestions.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .suggestion-item {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md) var(--space-lg);
    color: var(--primary-blue);
    text-decoration: none;
    transition: background-color var(--transition-fast);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .suggestion-item:hover {
    background: rgba(255, 107, 0, 0.1);
  }
  
  .suggestion-icon {
    color: var(--primary-orange);
    width: 20px;
  }
  
  .search-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-xl);
    max-width: 600px;
    margin: 0 auto;
  }
  
  .stat {
    text-align: center;
  }
  
  .stat-number {
    display: block;
    font-family: var(--font-primary);
    font-size: 2rem;
    font-weight: 800;
    color: var(--primary-orange);
    line-height: 1;
    margin-bottom: var(--space-xs);
  }
  
  .stat-label {
    font-size: 0.9rem;
    color: var(--neutral-light);
    font-weight: 500;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .search-input-container {
      flex-direction: column;
      gap: var(--space-md);
      padding: var(--space-lg);
    }
    
    .search-btn {
      width: 100%;
      justify-content: center;
    }
    
    .search-filters {
      gap: var(--space-sm);
    }
    
    .filter-btn {
      padding: var(--space-sm) var(--space-md);
      font-size: 0.8rem;
    }
    
    .search-stats {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-md);
    }
    
    .stat-number {
      font-size: 1.5rem;
    }
  }
  
  @media (max-width: 480px) {
    .search-title {
      font-size: 2rem;
    }
    
    .search-description {
      font-size: 1rem;
    }
    
    .search-stats {
      gap: var(--space-sm);
    }
    
    .stat-number {
      font-size: 1.25rem;
    }
    
    .stat-label {
      font-size: 0.8rem;
    }
  }
  
  /* Animation states */
  .search-content.animate-in {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .search-suggestions,
    .filter-btn,
    .search-btn {
      transition: none;
    }
  }
  
  /* Loading state */
  .search-input-container.loading {
    position: relative;
  }
  
  .search-input-container.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    right: 80px;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid var(--primary-orange);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: translateY(-50%) rotate(0deg); }
    100% { transform: translateY(-50%) rotate(360deg); }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.querySelector('.search-btn');
    const filterBtns = document.querySelectorAll('.filter-btn');
    const searchSuggestions = document.getElementById('search-suggestions');
    const searchContainer = document.querySelector('.search-input-container');
    
    let currentFilter = 'all';
    let searchTimeout;
    
    // Mock data for suggestions (in real app, this would come from API)
    const mockSuggestions = [
      { type: 'restaurant', name: 'La Bella Vita', cuisine: 'Italiana' },
      { type: 'restaurant', name: 'Tacos El Rey', cuisine: 'Mexicana' },
      { type: 'restaurant', name: 'Sushi Zen', cuisine: 'Japonesa' },
      { type: 'cuisine', name: 'Italiana', count: 12 },
      { type: 'cuisine', name: 'Mexicana', count: 18 },
      { type: 'dish', name: 'Pizza Margherita', restaurant: 'La Bella Vita' },
      { type: 'dish', name: 'Tacos de Carnitas', restaurant: 'Tacos El Rey' }
    ];
    
    // Search input handling
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value.trim();
        
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          handleSearch(query);
        }, 300);
        
        if (query.length > 0) {
          showSuggestions(query);
        } else {
          hideSuggestions();
        }
      });
      
      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          performSearch();
        } else if (e.key === 'Escape') {
          hideSuggestions();
        }
      });
      
      // Hide suggestions when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-box')) {
          hideSuggestions();
        }
      });
    }
    
    // Search button handling
    if (searchBtn) {
      searchBtn.addEventListener('click', performSearch);
    }
    
    // Filter buttons handling
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.getAttribute('data-filter');
        
        // Analytics tracking
        window.dispatchEvent(new CustomEvent('searchFilterChanged', {
          detail: {
            filter: currentFilter,
            timestamp: Date.now()
          }
        }));
        
        console.log('Filter changed to:', currentFilter);
        
        // Re-search with new filter if there's a query
        if (searchInput && searchInput.value.trim()) {
          handleSearch(searchInput.value.trim());
        }
      });
    });
    
    function handleSearch(query) {
      console.log('Searching for:', query, 'with filter:', currentFilter);
      
      // Analytics tracking
      window.dispatchEvent(new CustomEvent('searchPerformed', {
        detail: {
          query,
          filter: currentFilter,
          timestamp: Date.now()
        }
      }));
      
      // Here you would implement actual search logic
      // For now, just show loading state
      if (query.length > 2) {
        showLoadingState();
        
        setTimeout(() => {
          hideLoadingState();
          console.log('Search results would be displayed here');
        }, 1000);
      }
    }
    
    function performSearch() {
      const query = searchInput ? searchInput.value.trim() : '';
      if (query) {
        handleSearch(query);
        hideSuggestions();
      }
    }
    
    function showSuggestions(query) {
      if (!searchSuggestions || query.length < 2) return;
      
      const filteredSuggestions = mockSuggestions.filter(item => 
        item.name.toLowerCase().includes(query.toLowerCase()) ||
        (item.cuisine && item.cuisine.toLowerCase().includes(query.toLowerCase())) ||
        (item.restaurant && item.restaurant.toLowerCase().includes(query.toLowerCase()))
      ).slice(0, 5);
      
      if (filteredSuggestions.length > 0) {
        searchSuggestions.innerHTML = filteredSuggestions.map(item => {
          const icon = item.type === 'restaurant' ? 'fa-store' : 
                      item.type === 'cuisine' ? 'fa-utensils' : 'fa-star';
          
          const description = item.type === 'restaurant' ? item.cuisine :
                             item.type === 'cuisine' ? `${item.count} restaurantes` :
                             item.restaurant;
          
          return `
            <a href="#" class="suggestion-item" data-type="${item.type}" data-name="${item.name}">
              <i class="fas ${icon} suggestion-icon"></i>
              <div>
                <div style="font-weight: 600;">${item.name}</div>
                <div style="font-size: 0.8rem; opacity: 0.7;">${description}</div>
              </div>
            </a>
          `;
        }).join('');
        
        searchSuggestions.classList.add('active');
        
        // Add click handlers to suggestions
        searchSuggestions.querySelectorAll('.suggestion-item').forEach(item => {
          item.addEventListener('click', (e) => {
            e.preventDefault();
            const name = item.getAttribute('data-name');
            if (searchInput) {
              searchInput.value = name;
            }
            handleSearch(name);
            hideSuggestions();
          });
        });
      } else {
        hideSuggestions();
      }
    }
    
    function hideSuggestions() {
      if (searchSuggestions) {
        searchSuggestions.classList.remove('active');
      }
    }
    
    function showLoadingState() {
      if (searchContainer) {
        searchContainer.classList.add('loading');
      }
    }
    
    function hideLoadingState() {
      if (searchContainer) {
        searchContainer.classList.remove('loading');
      }
    }
    
    // Auto-focus search input when user starts typing
    document.addEventListener('keydown', (e) => {
      if (e.target === searchInput) return;
      if (e.ctrlKey || e.metaKey || e.altKey) return;
      
      // Check if user is typing a letter
      if (e.key.length === 1 && e.key.match(/[a-zA-Z0-9]/)) {
        if (searchInput) {
          searchInput.focus();
        }
      }
    });
  });
</script>