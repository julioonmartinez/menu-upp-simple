---
// src/components/HomePage/DishesSection.astro
interface TopDish {
  id: number;
  name: string;
  restaurant: string;
  rating: number;
  image: string;
  price: number;
  reviews: number;
}

interface Props {
  dishes?: TopDish[];
  title?: string;
  description?: string;
}

const {
  dishes = [
    {
      id: 1,
      name: "Pasta Carbonara Artesanal",
      restaurant: "La Bella Vita",
      rating: 4.9,
      image: "/images/restaurants/labellavita/cover.webp",
      price: 285,
      reviews: 127
    },
    {
      id: 2,
      name: "Tacos de Cochinita Pibil",
      restaurant: "Tacos El Rey",
      rating: 4.8,
      image: "/images/restaurants/tacoselrey/cover.webp", 
      price: 85,
      reviews: 245
    },
    {
      id: 3,
      name: "Sashimi Premium Selection",
      restaurant: "Sushi Zen",
      rating: 4.9,
      image: "/images/restaurants/sushizen/cover.webp",
      price: 450,
      reviews: 89
    }
  ],
  title = "Los M치s Valorados",
  description = "Descubre los platillos que han conquistado el paladar de nuestros usuarios"
} = Astro.props;

// Helper function to format price
const formatPrice = (price: number) => {
  return new Intl.NumberFormat('es-MX', {
    style: 'currency',
    currency: 'MXN',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).format(price);
};

// Helper function to format reviews
const formatReviews = (count: number) => {
  if (count === 1) return '1 rese침a';
  if (count < 1000) return `${count} rese침as`;
  return `${(count / 1000).toFixed(1)}k rese침as`;
};
---

<section class="dishes-section" id="platillos">
  <div class="container">
    <div class="section-header animate-on-scroll">
      <div class="section-badge">
        <i class="fas fa-fire"></i>
        <span>Platillos Populares</span>
      </div>
      <h2 class="section-title">{title.split(' ').map((word, i) => 
        i === title.split(' ').length - 1 ? 
        <span class="text-orange">{word}</span> : 
        word + ' '
      )}</h2>
      <p class="section-description">
        {description}
      </p>
    </div>
    
    <div class="dishes-grid animate-on-scroll">
      {dishes.map((dish, index) => (
        <div class="dish-card" style={`--delay: ${index * 0.1}s`} data-dish-id={dish.id}>
          <div class="dish-image">
            <img src={dish.image} alt={dish.name} loading="lazy" />
            <div class="dish-rating">
              <span class="rating-number">{dish.rating}</span>
              <i class="fas fa-star"></i>
            </div>
            <div class="dish-overlay">
              <button class="favorite-btn" aria-label="Agregar a favoritos">
                <i class="fas fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="dish-content">
            <div class="dish-restaurant">{dish.restaurant}</div>
            <h3 class="dish-name">{dish.name}</h3>
            <div class="dish-footer">
              <div class="dish-price">{formatPrice(dish.price)}</div>
              <div class="dish-reviews">{formatReviews(dish.reviews)}</div>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <div class="section-cta animate-on-scroll">
      <a href="#explorar" class="explore-btn">
        <span>Ver Todos los Platillos</span>
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>
  </div>
</section>

<style>
  .dishes-section {
    padding: var(--space-4xl) 0;
    background: var(--pure-white);
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
  }
  
  .section-header {
    text-align: center;
    margin-bottom: var(--space-4xl);
  }
  
  .section-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-lg);
    background: rgba(255, 107, 0, 0.1);
    border: 1px solid rgba(255, 107, 0, 0.3);
    border-radius: var(--radius-full);
    color: var(--primary-orange);
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: var(--space-lg);
  }
  
  .section-title {
    font-family: var(--font-primary);
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    line-height: 1.2;
    color: var(--primary-blue);
    margin-bottom: var(--space-lg);
  }
  
  .text-orange {
    color: var(--primary-orange);
  }
  
  .section-description {
    font-size: 1.2rem;
    color: var(--secondary-gray);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }
  
  .dishes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-2xl);
    margin-bottom: var(--space-4xl);
  }
  
  .dish-card {
    background: var(--pure-white);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-normal);
    animation: dishFloat 0.6s ease-out forwards;
    animation-delay: var(--delay);
    opacity: 0;
    transform: translateY(20px);
    cursor: pointer;
  }
  
  @keyframes dishFloat {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .dish-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
  }
  
  .dish-image {
    position: relative;
    height: 200px;
    overflow: hidden;
  }
  
  .dish-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }
  
  .dish-card:hover .dish-image img {
    transform: scale(1.05);
  }
  
  .dish-rating {
    position: absolute;
    top: var(--space-lg);
    right: var(--space-lg);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: var(--radius-full);
    font-weight: 600;
    color: var(--primary-orange);
    box-shadow: var(--shadow-sm);
  }
  
  .rating-number {
    font-size: 0.9rem;
  }
  
  .dish-rating i {
    font-size: 0.8rem;
  }
  
  .dish-overlay {
    position: absolute;
    top: var(--space-lg);
    left: var(--space-lg);
    opacity: 0;
    transition: opacity var(--transition-normal);
  }
  
  .dish-card:hover .dish-overlay {
    opacity: 1;
  }
  
  .favorite-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: none;
    border-radius: 50%;
    color: var(--secondary-gray);
    cursor: pointer;
    transition: all var(--transition-normal);
    box-shadow: var(--shadow-sm);
  }
  
  .favorite-btn:hover {
    background: var(--primary-orange);
    color: var(--pure-white);
    transform: scale(1.1);
  }
  
  .favorite-btn.active {
    background: var(--primary-orange);
    color: var(--pure-white);
  }
  
  .dish-content {
    padding: var(--space-xl);
  }
  
  .dish-restaurant {
    font-size: 0.875rem;
    color: var(--primary-orange);
    font-weight: 500;
    margin-bottom: var(--space-sm);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .dish-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary-blue);
    margin-bottom: var(--space-lg);
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .dish-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .dish-price {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary-orange);
    font-family: var(--font-primary);
  }
  
  .dish-reviews {
    font-size: 0.875rem;
    color: var(--secondary-gray);
    font-weight: 500;
  }
  
  .section-cta {
    text-align: center;
  }
  
  .explore-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-lg) var(--space-2xl);
    background: transparent;
    color: var(--primary-orange);
    border: 2px solid var(--primary-orange);
    border-radius: var(--radius-full);
    font-weight: 600;
    font-size: 1.1rem;
    text-decoration: none;
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;
  }
  
  .explore-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--gradient-primary);
    transform: translateX(-100%);
    transition: transform var(--transition-normal);
    z-index: -1;
  }
  
  .explore-btn:hover::before {
    transform: translateX(0);
  }
  
  .explore-btn:hover {
    color: var(--pure-white);
    border-color: var(--primary-orange);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .dishes-grid {
      grid-template-columns: 1fr;
      gap: var(--space-xl);
    }
    
    .dish-image {
      height: 180px;
    }
    
    .dish-content {
      padding: var(--space-lg);
    }
  }
  
  @media (max-width: 480px) {
    .section-title {
      font-size: 2rem;
    }
    
    .section-description {
      font-size: 1rem;
    }
    
    .dish-price {
      font-size: 1.25rem;
    }
    
    .explore-btn {
      padding: var(--space-md) var(--space-xl);
      font-size: 1rem;
    }
  }
  
  /* Animation states */
  .dish-card.animate-in {
    opacity: 1;
    transform: translateY(0);
  }
  
  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .dish-card {
      animation: none;
      opacity: 1;
      transform: none;
    }
    
    .dish-image img,
    .favorite-btn,
    .explore-btn {
      transition: none;
    }
  }
  
  /* High contrast mode */
  @media (prefers-contrast: high) {
    .dish-rating,
    .favorite-btn {
      border: 2px solid var(--primary-blue);
    }
    
    .explore-btn {
      border-width: 3px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Favorite button functionality
    const favoriteButtons = document.querySelectorAll('.favorite-btn');
    
    favoriteButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();
        
        const isActive = btn.classList.contains('active');
        btn.classList.toggle('active');
        
        const dishCard = btn.closest('.dish-card');
        const dishId = dishCard?.getAttribute('data-dish-id');
        const dishName = dishCard?.querySelector('.dish-name')?.textContent;
        
        // Analytics tracking
        window.dispatchEvent(new CustomEvent('dishFavorited', {
          detail: {
            dishId,
            dishName,
            action: isActive ? 'removed' : 'added',
            source: 'homepage',
            timestamp: Date.now()
          }
        }));
        
        // Visual feedback
        if (!isActive) {
          btn.style.animation = 'heartPulse 0.3s ease';
          setTimeout(() => {
            btn.style.animation = '';
          }, 300);
        }
        
        console.log(`Dish ${isActive ? 'removed from' : 'added to'} favorites:`, dishName);
      });
    });
    
    // Dish card click handling
    const dishCards = document.querySelectorAll('.dish-card');
    
    dishCards.forEach(card => {
      card.addEventListener('click', (e) => {
        // Don't trigger if clicking on favorite button
        if (e.target.closest('.favorite-btn')) return;
        
        const dishId = card.getAttribute('data-dish-id');
        const dishName = card.querySelector('.dish-name')?.textContent;
        const restaurantName = card.querySelector('.dish-restaurant')?.textContent;
        
        // Analytics tracking
        window.dispatchEvent(new CustomEvent('dishClicked', {
          detail: {
            dishId,
            dishName,
            restaurantName,
            source: 'homepage',
            timestamp: Date.now()
          }
        }));
        
        console.log('Dish clicked:', dishName, 'from', restaurantName);
        
        // Here you could navigate to dish detail or restaurant page
        // For now, just log the action
      });
    });
    
    // Performance optimization
    dishCards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        card.style.willChange = 'transform';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.willChange = 'auto';
      });
    });
  });
  
  // Add heart pulse animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes heartPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
  `;
  document.head.appendChild(style);
</script>