---
// PricingCard.astro
const { name, price, period, features, popular, index,  discount, popularText = "Más popular" } = Astro.props;

// Determinar precio con descuento
const hasDiscount = discount && (discount > 0) && (price > 0);
const discountedPrice = hasDiscount ? Math.round(price * (1 - discount / 100)) : price;
// Determinar clases de animación
const animationClass = index === 1 ? 'scale-in' : (index === 0 ? 'slide-in-left' : 'slide-in-right');
---

<div class={`pricing-card ${popular ? 'popular' : ''} ${animationClass}`}>
  {popular && (
    <div class="popular-badge">
      <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 2.5l2.39 5.09 5.61.41-4.25 3.98 1.27 5.52L10 14.13l-4.02 3.37 1.27-5.52-4.25-3.98 5.61-.41L10 2.5z" fill="#fff"/>
      </svg>
      {popularText}
    </div>
  )}
  {hasDiscount && price > 0 && discount > 0 && (
    <div class="discount-badge">-{discount > 0 ? discount : ''}%</div>
  )}

  <div class="card-header">
    <h3>{name}</h3>
    <div class="price">
      {price === 0 ? (
        <span class="amount free">Gratis</span>
      ) : (
        <>
          {(hasDiscount) && <span class="old-price">${price}</span>}
          <span class="amount">${discountedPrice}</span>
          <span class="period">{period}</span>
        </>
      )}
    </div>
  </div>

  <ul class="features">
    {features.map((feature: any) => (
      <li>
        <span class="check-icon">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="8" cy="8" r="8" fill="var(--primary-light)"/>
            <path d="M12 5L7 11L4 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        {feature}
      </li>
    ))}
  </ul>

  <div class="card-footer">
    <slot />
  </div>
</div>


<style>
  .pricing-card {
    background: rgba(255,255,255,0.7);
    backdrop-filter: blur(8px);
    border-radius: 1.5rem;
    box-shadow: 0 8px 32px 0 rgba(31,38,135,0.10), var(--shadow-md);
    padding: var(--space-lg) var(--space-md);
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    transition: var(--transition), box-shadow 0.4s cubic-bezier(.4,2,.6,1), transform 0.3s;
    overflow: visible;
    border: 1.5px solid var(--light-gray);
    min-width: 0;
    min-height: 0;
    box-sizing: border-box;
  }
  .pricing-card.popular {
    border: 2.5px solid var(--primary);
    box-shadow: 0 10px 36px 0 rgba(241,90,41,0.18), 0 0 0 4px var(--primary-light), var(--shadow-primary);
    z-index: 2;
    /* transform: scale(1.04); */
  }
  .popular-badge {
    position: absolute;
    top: 22px;
    left: -44px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: #fff;
    font-size: 0.92rem;
    font-weight: 700;
    padding: 0.45rem 2.3rem 0.45rem 1.2rem;
    transform: rotate(-20deg);
    box-shadow: 0 2px 8px rgba(241,90,41,0.13);
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    letter-spacing: 0.5px;
    z-index: 4;
    border-left: 4px solid var(--primary-dark);
    animation: badge-pop 1.5s infinite alternate;
  }
  .popular-badge svg {
    width: 1.1rem;
    height: 1.1rem;
    margin-right: 0.3rem;
    filter: drop-shadow(0 1px 2px var(--primary-dark));
  }
  @keyframes badge-pop {
    0% { filter: brightness(1); }
    100% { filter: brightness(1.12); }
  }
  .discount-badge {
    position: absolute;
    top: 0.7rem;
    right: 0.7rem;
    background: var(--primary);
    color: #fff;
    border-radius: 50%;
    width: 5rem;
    height: 5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    font-weight: 900;
    box-shadow: 0 2px 12px rgba(241,90,41,0.18);
    padding: 1.5rem;
    z-index: 4;
  }
  .card-header {
    margin-bottom: var(--space-md);
    padding-bottom: 0.5rem;
    border-bottom: 1.5px solid var(--light-gray);
    background: transparent;
  }
  .card-header h3{
    text-align: center;
    font-family: var(--font-display);
    font-size: 1.18rem;
    font-weight: 800;
    color: var(--primary-dark);
    margin-bottom: 0.2rem;
    letter-spacing: 0.1px;
  }
  .price {
    display: flex;
    align-items: baseline;
    gap: 0.3rem;
    justify-content: center;
    margin-top: 0.2rem;
  }
  .amount {
    font-size: 3rem;
    font-weight: 900;
    color: var(--primary);
    letter-spacing: -0.5px;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 8px rgba(241,90,41,0.10);
  }
  .amount.free {
    color: var(--primary);
    font-size: 3rem;
    background: none;
    -webkit-text-fill-color: var(--primary);
    text-shadow: none;
  }
  .period {
    color: var(--gray);
    font-size: 0.9rem;
    margin-left: 0.1rem;
    font-weight: 600;
  }
  .features {
    flex-grow: 1;
    list-style: none;
    padding: 0;
    margin: 0 0 var(--space-lg) 0;
    min-width: 0;
  }
  .features li {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 1.01rem;
    color: var(--gray);
    font-weight: 500;
    letter-spacing: 0.05px;
    min-width: 0;
    word-break: break-word;
  }
  .check-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1.2rem;
    height: 1.2rem;
    background: linear-gradient(135deg, var(--primary-light) 60%, var(--primary) 100%);
    border-radius: var(--radius-full);
    box-shadow: 0 1px 4px rgba(241,90,41,0.08);
    flex-shrink: 0;
  }
  .features li svg {
    margin: 0;
    width: 1rem;
    height: 1rem;
  }
  .card-footer {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 0.3rem;
    min-width: 0;
  }
  .card-footer :global(.button),
  .card-footer button,
  .card-footer a {
    font-size: 1.13rem;
    padding: 1.1rem 0;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    color: #fff;
    border-radius: 1.2rem;
    box-shadow: 0 2px 8px rgba(241,90,41,0.13);
    font-weight: 800;
    letter-spacing: 0.5px;
    border: none;
    transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
    outline: none;
    cursor: pointer;
    margin-top: 0.2rem;
  }
  .card-footer :global(.button):hover,
  .card-footer button:hover,
  .card-footer a:hover {
    background: linear-gradient(90deg, var(--primary-dark), var(--primary));
    box-shadow: 0 4px 16px rgba(241,90,41,0.18);
    transform: translateY(-2px) scale(1.03);
  }
  .old-price {
    text-decoration: line-through;
    color: var(--gray);
    font-size: 1.05rem;
    margin-right: 0.3rem;
    opacity: 0.7;
    font-weight: 600;
  }
  @media (max-width: 768px) {
    .pricing-card {
      padding: var(--space-md) 0.7rem;
      border-radius: 1.1rem;
    }
    .features li {
      margin-bottom: 0.3rem;
      font-size: 0.93rem;
    }
    .amount {
      font-size: 2.6rem;
    }
    .card-header h3 {
      font-size: 1.05rem;
    }
    .popular-badge {
      left: -30px;
      top: 14px;
      font-size: 0.8rem;
      padding: 0.3rem 1.3rem 0.3rem 0.7rem;
    }
    .discount-badge {
      width: 4rem;
      height: 4rem;
      font-size: 1rem;
      top: 0.5rem;
      right: 0.5rem;
      padding: 1rem;
    }
  }
</style>